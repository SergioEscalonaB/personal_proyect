INTOCABLE
COB_CODIGO
CLI_CODIGO
TAR_CODIGO


---------------------------------------------
CARGAR COBRO
SELECT * FROM COBRO
-Carga todos los cobros del sistema

---------------------------------------------
CARGAR LOS CLIENTES DE UN COBRO
SELECT * FROM CLIENTES
where COB_CODIGO = "Yayo"
-Reemplazar lo que esta en comilla

---------------------------------------------
CARGAR SOLO LOS CLIENTES ACTIVOS DEL COBRO
SELECT * FROM CLIENTES
where COB_CODIGO = "Yayo"
AND ESTADO IS NULL

SELECT * FROM CLIENTES C
JOIN TARGETA T
ON C.CLI_CODIGO = T.CLI_CODIGO
WHERE COB_CODIGO = "Yayo"
ORDER BY CAST(ITEN AS SIGNED)

---------------------------------------------
OBTENIDENDO TARJETAS QUE NO ESTAN EN 0
ESTAN SON LAS QUE SE FILTRAN PARA MOSTAR EL COBRO

SELECT *
FROM CLIENTES C
INNER JOIN TARGETA T
    ON C.CLI_CODIGO = T.CLI_CODIGO

LEFT JOIN (
    SELECT TAR_CODIGO, DES_RESTA
    FROM (
        SELECT 
            TAR_CODIGO,
            DES_RESTA,
            ROW_NUMBER() OVER (PARTITION BY TAR_CODIGO ORDER BY DES_FECHA DESC) AS rn,
            MAX(CASE WHEN DES_RESTA = 0 THEN 1 ELSE 0 END)
                OVER (PARTITION BY TAR_CODIGO) AS tuvo_cero
        FROM DESCRIPCION
    ) X
    WHERE rn = 1
      AND tuvo_cero = 0
) D ON T.TAR_CODIGO = D.TAR_CODIGO

WHERE T.ESTADO = 'ACTIVA'
  AND C.COB_CODIGO = 'Yayo'
  -- esta línea permite tarjetas nuevas SIN descripción
  AND (D.TAR_CODIGO IS NOT NULL OR NOT EXISTS (
        SELECT 1 
        FROM DESCRIPCION D2 
        WHERE D2.TAR_CODIGO = T.TAR_CODIGO
      ))

ORDER BY CAST(T.ITEN AS SIGNED);

LIMIT 1 OFFSET 0; --primero (aca es donde manejamos el orden)

-----------------------------------------
yo solo

SELECT * FROM CLIENTES C
INNER JOIN TARGETA T
ON C.CLI_CODIGO = T.CLI_CODIGO
LEFT JOIN DESCRIPCION D
ON T.TAR_CODIGO = D.TAR_CODIGO
WHERE T.ESTADO = "ACTIVA"
AND COB_CODIGO = "Yayo"
ORDER BY CAST(ITEN AS SIGNED)
